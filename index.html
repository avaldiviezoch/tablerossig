<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üìä Biblioteca ‚Äî Panel con Previsualizaci√≥n Derecha</title>
  <meta name="color-scheme" content="dark" />
  <style>
    :root{
      --bg:#0a0e1a; --panel:#111827; --ink:#f1f5f9; --muted:#94a3b8; --stroke:#1e293b; --accent:#334155;
      --btn1:#3b82f6; --btn2:#10b981; --btn3:#f59e0b; --btn4:#8b5cf6;
      --shadow:0 4px 20px rgba(0,0,0,.35); --shadow-hover:0 8px 30px rgba(0,0,0,.45);
      --radius:12px; --radius-sm:8px;
      --base-w:1280px; --base-h:800px;
      --gap:18px;
      --left-w:560px;                 /* ancho columna izquierda */
      --right-w: min(42vw, 720px);    /* ancho panel derecho */
      --hdr-h:36px;
    }
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(135deg, var(--bg), #0f172a);
      color:var(--ink); font-family:Segoe UI, system-ui, -apple-system, sans-serif;
    }
    .shell{
      display:grid; grid-template-columns:minmax(320px, var(--left-w)) 1fr;
      gap:var(--gap); max-width:1400px; margin:0 auto; padding:18px;
    }
    header{grid-column:1 / -1; margin-bottom:6px}
    h1{margin:0 0 4px; font-size:1.6rem; font-weight:900; color:#60a5fa}
    .sub{color:var(--muted); font-size:.95rem}

    /* Columna izquierda (lista) */
    .left{
      display:flex; flex-direction:column; gap:var(--gap);
    }
    .card{
      background:color-mix(in oklab, var(--panel) 98%, transparent);
      border:1px solid var(--stroke); border-radius:var(--radius); box-shadow:var(--shadow);
      overflow:hidden;
    }
    .card > .title{
      display:flex; align-items:center; gap:10px; padding:14px 16px; font-weight:800;
      border-bottom:1px solid var(--stroke);
      background:linear-gradient(to bottom, color-mix(in oklab, var(--panel) 98%, transparent), color-mix(in oklab, var(--panel) 92%, transparent));
    }
    .grid{
      display:grid; gap:12px; padding:14px; grid-template-columns:1fr;
    }
    .btn{
      display:block; text-decoration:none; color:inherit; font-weight:750; font-size:.95rem;
      padding:14px 16px; border-radius:var(--radius-sm); border:1px solid var(--stroke);
      background:linear-gradient(135deg, color-mix(in oklab, var(--btn1) 35%, transparent), color-mix(in oklab, var(--panel) 90%, transparent));
      box-shadow:var(--shadow); transition:.25s; position:relative; overflow:hidden;
    }
    .btn:hover{ transform:translateY(-2px); box-shadow:var(--shadow-hover); border-color:color-mix(in oklab, var(--btn1) 60%, transparent); }
    .btn:focus-visible{ outline:2px solid color-mix(in oklab, var(--btn1) 70%, transparent); outline-offset:2px; }

    /* Variantes opcionales (por si luego agregas m√°s) */
    .v2{ background:linear-gradient(135deg, color-mix(in oklab, var(--btn2) 35%, transparent), color-mix(in oklab, var(--panel) 90%, transparent)); }
    .v3{ background:linear-gradient(135deg, color-mix(in oklab, var(--btn3) 35%, transparent), color-mix(in oklab, var(--panel) 90%, transparent)); }
    .v4{ background:linear-gradient(135deg, color-mix(in oklab, var(--btn4) 35%, transparent), color-mix(in oklab, var(--panel) 90%, transparent)); }

    /* Panel derecho (previsualizaci√≥n fija) */
    .right{
      position:sticky; top:18px; height:calc(100dvh - 36px);
      min-height:480px; display:flex; flex-direction:column; gap:10px;
    }
    .pv{
      flex:1; min-height:360px; width:100%;
      max-width:var(--right-w);
      background:var(--panel); border:1px solid var(--stroke); border-radius:var(--radius); box-shadow:var(--shadow-hover);
      display:grid; grid-template-rows:auto 1fr auto; overflow:hidden;
    }
    .pv-hdr{
      height:var(--hdr-h); display:flex; align-items:center; gap:10px; padding:0 12px; border-bottom:1px solid var(--stroke);
      background:linear-gradient(to bottom, color-mix(in oklab, var(--panel) 98%, transparent), color-mix(in oklab, var(--panel) 92%, transparent));
    }
    .pv-title{ flex:1; font-weight:800; font-size:.95rem; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .pv-btn{
      appearance:none; border:1px solid var(--stroke); background:color-mix(in oklab, var(--panel) 90%, transparent);
      color:inherit; border-radius:6px; padding:6px 10px; font-weight:700; font-size:.8rem; cursor:pointer; transition:.2s;
    }
    .pv-btn:hover{ transform:translateY(-1px); border-color:var(--accent); }

    .pv-wrap{
      position:relative; margin:10px; border:1px solid var(--stroke); border-radius:8px; overflow:hidden; background:#00000015;
    }
    .pv-canvas{
      position:relative; width:100%; height:100%;
      /* mantenemos relaci√≥n 16:10 similar a base-w/h */
      aspect-ratio: 16 / 10;
      background: #0b1020;
    }
    .pv-frame{
      position:absolute; inset:auto auto  auto auto; top:0; left:0;
      border:0; width:var(--base-w); height:var(--base-h); transform-origin:0 0; pointer-events:none; background:var(--bg);
    }
    .pv-state{
      position:absolute; right:8px; bottom:8px; padding:6px 10px; font-size:12px; line-height:1; border-radius:999px;
      background:rgba(17,24,39,.75); border:1px solid var(--stroke); color:var(--muted);
    }
    .pv-thumb{
      position:absolute; inset:0; width:100%; height:100%; object-fit:cover; display:none;
    }
    .pv-cap{
      height:18px; font-size:.78rem; color:var(--muted); padding:0 12px 10px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
    }

    /* Estado visual */
    .pv.loading .pv-state{ color:#e5e7eb }
    .pv.ready   .pv-state{ color:#bbf7d0; background:rgba(20,83,45,.65); border-color:#14532d }
    .pv.blocked .pv-state{ color:#fecaca; background:rgba(127,29,29,.7); border-color:#7f1d1d }
    .pv.blocked .pv-thumb{ display:block }

    /* Responsive */
    @media (max-width: 1100px){
      :root{ --left-w:100%; }
      .shell{ grid-template-columns:1fr; }
      .right{ position:static; height:auto }
      .pv{ max-width:100% }
    }

    /* Scrollbar */
    ::-webkit-scrollbar{ width:8px }
    ::-webkit-scrollbar-track{ background:var(--bg) }
    ::-webkit-scrollbar-thumb{ background:var(--stroke); border-radius:4px }
    ::-webkit-scrollbar-thumb:hover{ background:var(--accent) }
  </style>
</head>
<body>
  <div class="shell">
    <header>
      <h1>üìä Biblioteca ‚Äî Panel de Previsualizaci√≥n Derecha</h1>
      <div class="sub">Pasa el mouse por los enlaces para ver la vista preliminar. F√≠jala si necesitas interactuar.</div>
    </header>

    <!-- Columna izquierda -->
    <div class="left">
      <!-- DASHBOARDS -->
      <section class="card" aria-labelledby="t-dash">
        <div class="title" id="t-dash">üìà Dashboards</div>
        <div class="grid">
          <!-- √öNICO ENLACE SOLICITADO -->
          <a class="btn" href="/propuestaccppdispersos.html" target="_blank" rel="noopener">Propuesta CCPP Dispersos</a>
        </div>
      </section>

      <!-- VISORES -->
      <section class="card" aria-labelledby="t-vis">
        <div class="title" id="t-vis">üó∫Ô∏è Visores</div>
        <div class="grid">
          <!-- (vac√≠o por ahora) -->
        </div>
      </section>

      <!-- OTROS -->
      <section class="card" aria-labelledby="t-otros">
        <div class="title" id="t-otros">üß∞ Otros</div>
        <div class="grid">
          <!-- (vac√≠o por ahora) -->
        </div>
      </section>
    </div>

    <!-- Panel derecho fijo -->
    <aside class="right" aria-label="Previsualizaci√≥n">
      <div class="pv loading" id="pv">
        <div class="pv-hdr">
          <div class="pv-title" id="pvtitle">Vista preliminar</div>
          <button class="pv-btn" id="pvlock" type="button" title="Fijar para interactuar">Fijar</button>
          <a class="pv-btn" id="pvopen" href="#" target="_blank" rel="noopener">Abrir</a>
        </div>
        <div class="pv-wrap">
          <div class="pv-canvas">
            <iframe id="pvframe" class="pv-frame" sandbox="allow-scripts allow-same-origin"></iframe>
            <img id="pvthumb" class="pv-thumb" alt="Miniatura de respaldo" />
            <div class="pv-state" id="pvstate">Pasa el mouse por un enlace‚Ä¶</div>
          </div>
        </div>
        <div class="pv-cap" id="pvcap"></div>
      </div>
    </aside>
  </div>

  <script>
    // Utilidades
    const $ = (q) => document.querySelector(q);
    const pv      = $('#pv');
    const pvtitle = $('#pvtitle');
    const pvopen  = $('#pvopen');
    const pvlock  = $('#pvlock');
    const pvframe = $('#pvframe');
    const pvthumb = $('#pvthumb');
    const pvstate = $('#pvstate');
    const pvcap   = $('#pvcap');

    let currentURL = '';
    let locked = false;
    let hoverTimer = null;
    let blockTimer = null;

    function cssVar(name){
      return parseFloat(getComputedStyle(document.documentElement).getPropertyValue(name));
    }

    function applyScale(){
      const canvas = document.querySelector('.pv-canvas');
      if(!canvas) return;
      const w = canvas.clientWidth;
      const h = canvas.clientHeight;
      const baseW = cssVar('--base-w');
      const baseH = cssVar('--base-h');
      const scale = Math.min(w/baseW, h/baseH);
      pvframe.style.transform = `scale(${scale})`;
    }
    window.addEventListener('resize', applyScale);

    function setState(state, text){
      pv.classList.remove('loading','ready','blocked');
      pv.classList.add(state);
      pvstate.textContent = text || (
        state==='loading' ? 'Cargando vista‚Ä¶' :
        state==='ready'   ? 'Vista lista' :
        'Vista previa no disponible'
      );
    }

    function previewLink(anchor){
      if(locked) return;
      const href = anchor.getAttribute('href');
      const label = anchor.textContent.trim();
      const thumb = anchor.getAttribute('data-thumb');

      pvtitle.textContent = label || 'Vista preliminar';
      pvopen.href = href || '#';
      pvcap.textContent = href || '';

      setState('loading', 'Cargando vista‚Ä¶');
      pvthumb.style.display = 'none';
      if(thumb){ pvthumb.src = thumb; } else { pvthumb.removeAttribute('src'); }

      clearTimeout(hoverTimer);
      hoverTimer = setTimeout(()=>{
        if(currentURL !== href || pvframe.src !== href){
          currentURL = href;
          pvframe.src = href;
        }else{
          setState('ready', 'Vista lista');
        }
      }, 140);

      clearTimeout(blockTimer);
      blockTimer = setTimeout(()=>{
        if(pv.classList.contains('loading')){
          setState('blocked', 'El sitio restringe la incrustaci√≥n (usa ‚ÄúAbrir‚Äù).');
          if(pvthumb.src) pvthumb.style.display = 'block';
        }
      }, 2800);

      applyScale();
    }

    // Cargar ok / error
    pvframe.addEventListener('load', ()=> setState('ready', 'Vista lista') );
    pvframe.addEventListener('error',()=> setState('blocked', 'Error al cargar vista') );

    // Hover global en enlaces .btn
    document.addEventListener('mouseover', (e)=>{
      const a = e.target.closest('a.btn');
      if(!a) return;
      previewLink(a);
    });

    // Accesibilidad con foco
    document.addEventListener('focusin', (e)=>{
      const a = e.target.closest('a.btn');
      if(a) previewLink(a);
    });

    // Bot√≥n fijar
    pvlock.addEventListener('click', ()=>{
      locked = !locked;
      pvlock.textContent = locked ? 'Desfijar' : 'Fijar';
      pvframe.style.pointerEvents = locked ? 'auto' : 'none';
      // Mantener estado "ready" si ya carg√≥
      if(pv.classList.contains('ready') === false && pvframe.src) setState('ready','Vista lista');
    });

    // Inicial
    applyScale();
    // (Opcional) Cargar algo por defecto: deja vac√≠o para que espere hover.

  </script>
</body>
</html>

